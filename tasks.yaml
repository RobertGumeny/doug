epic:
  id: "EPIC-6"
  name: "Init Subcommand & Templates"
  tasks:
    - id: "EPIC-6-001"
      type: "feature"
      status: "TODO"
      description: "Implement cmd/init.go. The init command: detects build system (or accepts --build-system flag), generates doug.yaml with sensible defaults and inline comments explaining each field, generates a starter tasks.yaml with an example epic, generates a PRD.md template. Does not overwrite existing files without --force."
      acceptance_criteria:
        - "Running doug init in a directory with go.mod generates a config with build_system: go pre-filled"
        - "Generated doug.yaml has inline YAML comments explaining each field"
        - "Generated tasks.yaml has a complete example epic with two tasks and all required fields (id, type, status, description, acceptance_criteria)"
        - "init exits with non-zero and a clear message if project-state.yaml or tasks.yaml already exists; --force flag overwrites"

    - id: "EPIC-6-002"
      type: "feature"
      status: "TODO"
      description: "Create internal/templates/templates.go using //go:embed. Embed: CLAUDE.md, AGENTS.md, SESSION_RESULTS_TEMPLATE.md, BUG_REPORT_TEMPLATE.md, FAILURE_REPORT_TEMPLATE.md, and the skills/ directory. The init command copies these into the target project. Session file creation in the agent layer reads from the embedded template, not from disk."
      acceptance_criteria:
        - "All template files are embedded at compile time using //go:embed; no runtime disk path dependency for templates"
        - "init copies all templates to the project's .claude/ directory (skills) and project root (CLAUDE.md, AGENTS.md)"
        - "CreateSessionFile uses the embedded session results template — update Epic 4 implementation if needed"
        - "go build ./... passes; go test ./... verifies the embed FS contains all expected file paths"
        - "SESSION_RESULTS_TEMPLATE.md embedded here has exactly three frontmatter fields: outcome, changelog_entry, dependencies_added — no estimated_tokens, no duration_seconds"

    - id: "EPIC-6-003"
      type: "feature"
      status: "TODO"
      description: "Write integration/smoke_test.go with a test that exercises the full orchestrator loop end-to-end using a mock agent. The mock agent is a small Go binary or shell script that reads its invocation context and writes a valid session file with outcome: SUCCESS. Verifies a two-task epic runs to completion, updates task statuses correctly, and produces two commits."
      acceptance_criteria:
        - "Test creates a real git repository in t.TempDir() with tasks.yaml, project-state.yaml, and go.mod"
        - "Mock agent writes a minimal valid session result file: outcome SUCCESS, no changelog entry, no deps"
        - "After the loop runs with max_iterations=5, both tasks are DONE in tasks.yaml"
        - "git log in the test repo shows exactly two task commits with messages matching feat: EPIC-X-001 and feat: EPIC-X-002 patterns"
        - "Test is runnable with go test ./integration/... and completes in under 30 seconds"

    - id: "EPIC-6-004"
      type: "feature"
      status: "TODO"
      description: "Final automated QA pass. Run the full test suite and verify the binary is production-ready. All checks must be performed programmatically. Confirm go test ./... passes, the smoke test passes, the binary builds cleanly, doug init produces a valid scaffold, and go vet ./... reports no issues."
      acceptance_criteria:
        - "go test ./... passes with zero failures across all packages"
        - "go test ./integration/... passes: two-task epic with mock agent completes, both tasks DONE, two commits in git log"
        - "go build ./... produces a binary with no errors"
        - "go vet ./... reports no issues"
        - "doug init run in a fresh temp directory produces doug.yaml, tasks.yaml, PRD.md, CLAUDE.md, and AGENTS.md"
        - "Embedded templates verified: embed FS contains SESSION_RESULTS_TEMPLATE.md, BUG_REPORT_TEMPLATE.md, FAILURE_REPORT_TEMPLATE.md, and at least one skill file"
