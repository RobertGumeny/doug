epic:
  id: "EPIC-6"
  name: "Init Subcommand & Templates"
  tasks:
    - id: "EPIC-6-001"
      type: "feature"
      status: "DONE"
      description: "Implement cmd/init.go. The init command: detects build system (or accepts --build-system flag), generates doug.yaml with sensible defaults and inline comments explaining each field, generates a starter tasks.yaml with an example epic, generates a PRD.md template. Does not overwrite existing files without --force."
      acceptance_criteria:
        - "Running doug init in a directory with go.mod generates a config with build_system: go pre-filled"
        - "Generated doug.yaml has inline YAML comments explaining each field"
        - "Generated tasks.yaml has a complete example epic with two tasks and all required fields (id, type, status, description, acceptance_criteria)"
        - "init exits with non-zero and a clear message if project-state.yaml or tasks.yaml already exists; --force flag overwrites"
    - id: "EPIC-6-002"
      type: "feature"
      status: "DONE"
      description: |
        Split internal/templates/ into two subdirectories and update templates.go to embed both.

        internal/templates/runtime/
          session_result.md  — used by CreateSessionFile at runtime; NOT copied to user projects.
                               This is a NEW file (the existing internal/templates/session_result.md
                               must be moved here). It has exactly three frontmatter fields:
                               outcome, changelog_entry, dependencies_added.

        internal/templates/init/
          CLAUDE.md                    — template CLAUDE.md for new projects (not this repo's own CLAUDE.md)
          AGENTS.md                    — template AGENTS.md for new projects
          SESSION_RESULTS_TEMPLATE.md  — template agents fill out after each task
          BUG_REPORT_TEMPLATE.md       — template for bug reports
          FAILURE_REPORT_TEMPLATE.md   — template for failure reports
          skills/                      — skill files directory (implement-feature, implement-bugfix,
                                         implement-documentation)

        The init command copies the init/ files into the target project with no filename
        transformations — files land at their exact destination names. No _TEMPLATE suffix
        stripping or any other rename logic is needed.

        SESSION_RESULTS_TEMPLATE.md (init copy, for agents to fill out) is distinct from
        session_result.md (runtime copy, used internally by CreateSessionFile). They may share
        the same three-field frontmatter shape but serve different purposes.
      acceptance_criteria:
        - "internal/templates/runtime/ and internal/templates/init/ both exist and are embedded via //go:embed in templates.go; no runtime disk path dependency for templates"
        - "internal/templates/session_result.md is moved to internal/templates/runtime/session_result.md; any existing embed reference is updated"
        - "init copies init/ files to the target project: CLAUDE.md and AGENTS.md to project root, *_TEMPLATE.md files to their respective logs/ subdirectories, skills/ to .claude/skills/"
        - "CreateSessionFile uses the embedded runtime/session_result.md template — update Epic 4 implementation if needed"
        - "go build ./... passes; go test ./... verifies the embed FS contains runtime/session_result.md and all expected init/ file paths"
        - "runtime/session_result.md has exactly three frontmatter fields: outcome, changelog_entry, dependencies_added — no task_id, no timestamp, no files_modified, no tests_run, no build_successful"
    - id: "EPIC-6-003"
      type: "feature"
      status: "DONE"
      description: "Write integration/smoke_test.go with a test that exercises the full orchestrator loop end-to-end using a mock agent. The mock agent is a small Go binary or shell script that reads its invocation context and writes a valid session file with outcome: SUCCESS. Verifies a two-task epic runs to completion, updates task statuses correctly, and produces two commits."
      acceptance_criteria:
        - "Test creates a real git repository in t.TempDir() with tasks.yaml, project-state.yaml, and go.mod"
        - "Mock agent writes a minimal valid session result file: outcome SUCCESS, no changelog entry, no deps"
        - "After the loop runs with max_iterations=5, both tasks are DONE in tasks.yaml"
        - "git log in the test repo shows exactly two task commits with messages matching feat: EPIC-X-001 and feat: EPIC-X-002 patterns"
        - "Test is runnable with go test ./integration/... and completes in under 30 seconds"
    - id: "EPIC-6-004"
      type: "feature"
      status: "DONE"
      description: "Final automated QA pass. Run the full test suite and verify the binary is production-ready. All checks must be performed programmatically. Confirm go test ./... passes, the smoke test passes, the binary builds cleanly, doug init produces a valid scaffold, and go vet ./... reports no issues."
      acceptance_criteria:
        - "go test ./... passes with zero failures across all packages"
        - "go test ./integration/... passes: two-task epic with mock agent completes, both tasks DONE, two commits in git log"
        - "go build ./... produces a binary with no errors"
        - "go vet ./... reports no issues"
        - "doug init run in a fresh temp directory produces doug.yaml, tasks.yaml, PRD.md, CLAUDE.md, and AGENTS.md"
        - "Embedded templates verified: embed FS contains SESSION_RESULTS_TEMPLATE.md, BUG_REPORT_TEMPLATE.md, FAILURE_REPORT_TEMPLATE.md, and at least one skill file"
