epic:
  id: "EPIC-7"
  name: "Big 3 Agent Support (Claude, Codex, Gemini)"
  tasks:
    - id: "EPIC-7-001"
      type: "feature"
      status: "TODO"
      description: "Move skill resolution from .claude/skills/ to .agents/skills/ and remove all agent-specific references from hardcoded fallback content."
      acceptance_criteria:
        - "SkillsConfigPath default value points to .agents/skills-config.yaml"
        - "GetSkillForTaskType resolves SKILL.md files from .agents/skills/{skill-name}/SKILL.md with no logic changes"
        - "No strings in hardcodedSkillContent reference CLAUDE.md by name"
        - "go test ./... passes"

    - id: "EPIC-7-002"
      type: "feature"
      status: "TODO"
      description: "Update doug init to scaffold .agents/ paths instead of .claude/skills/, and add .gemini/settings.json template and routing."
      acceptance_criteria:
        - "skills-config.yaml case in copyInitTemplates routes to {dir}/.agents/skills-config.yaml"
        - "skills/ prefix case in copyInitTemplates routes to {dir}/.agents/skills/{rel}"
        - "A new case routes .gemini/settings.json template to {dir}/.gemini/settings.json"
        - ".claude/settings.json routing is unchanged"
        - "doug init does not create any files under .claude/skills/"
        - 'internal/templates/init/.gemini/settings.json exists, is valid JSON, and sets context.fileName to ["AGENTS.md"] with no other settings'
        - "doug init creates .gemini/settings.json in the target project root"
        - "go test ./... passes"

    - id: "EPIC-7-003"
      type: "feature"
      status: "TODO"
      description: "Move the three SKILL.md template files into the init tree path that maps to .agents/skills/ and update the skills-config.yaml comment block to match."
      acceptance_criteria:
        - "implement-feature/SKILL.md, implement-bugfix/SKILL.md, and implement-documentation/SKILL.md exist under the template path that maps to .agents/skills/"
        - "No SKILL.md files remain under a template path that maps to .claude/skills/"
        - "skills-config.yaml comment block references .agents/skills/{skill-name}/SKILL.md with no remaining references to .claude/skills/"
        - "doug init creates .agents/skills/implement-feature/SKILL.md, .agents/skills/implement-bugfix/SKILL.md, and .agents/skills/implement-documentation/SKILL.md"
        - "go test ./... passes"

    - id: "EPIC-7-004"
      type: "feature"
      status: "TODO"
      description: "Replace AGENTS.md with a terse, agent-facing instruction file modeled on CLAUDE.md, including a complete deny list."
      acceptance_criteria:
        - "AGENTS.md contains no references to the orchestrator, doug binary, agent contract, or internal session mechanics"
        - "Deny list explicitly prohibits: all git commands, writes to project-state.yaml and tasks.yaml, reads of project-state.yaml and tasks.yaml, creating or modifying files in logs/, reading .env files, writing any .yaml file, and sudo"
        - "Skill files are referenced as living in .agents/skills/ not .claude/skills/"
        - "File structure and voice are consistent with CLAUDE.md: context sources, allow, deny, escalation, session summary"
        - "Windows platform note is present and matches the one in CLAUDE.md"
        - "No human-facing explanatory prose â€” file reads as agent instructions only"

    - id: "EPIC-7-005"
      type: "feature"
      status: "TODO"
      description: "Add commented Codex and Gemini agent_command examples to the doug.yaml template generated by doug init."
      acceptance_criteria:
        - "Default agent_command in generated doug.yaml remains claude"
        - "Generated doug.yaml includes commented examples for agent_command: codex and agent_command: gemini"
        - "Generated doug.yaml is valid YAML and parses without errors"

    - id: "EPIC-7-006"
      type: "feature"
      status: "TODO"
      description: "Move kb_enabled from project-state.yaml into doug.yaml as a first-class config field."
      acceptance_criteria:
        - "OrchestratorConfig in internal/config/config.go includes a KBEnabled field"
        - "doug run reads kb_enabled exclusively from doug.yaml via OrchestratorConfig"
        - "kb_enabled is no longer read from or written to project-state.yaml anywhere in the codebase"
        - "kb_enabled field is removed from the ProjectState struct in internal/types/types.go"
        - "projectStateContent() in cmd/init.go no longer includes kb_enabled"
        - "dougYAMLContent() in cmd/init.go includes kb_enabled: true with a comment"
        - "go test ./... passes"

    - id: "EPIC-7-007"
      type: "bugfix"
      status: "TODO"
      description: "Fix UpdateChangelog to explicitly scope subsection insertion to the ## [Unreleased] block, eliminating silent insertion into wrong sections and file-wide idempotency false positives."
      acceptance_criteria:
        - "UpdateChangelog locates ## [Unreleased] first and returns an error if it is absent"
        - "Subsection search (### Added, ### Fixed, ### Changed) is scoped to within the ## [Unreleased] block only"
        - "Idempotency check is scoped to the ## [Unreleased] block only, not the entire file"
        - "UpdateChangelog returns a descriptive error if the target subsection is not found within ## [Unreleased]"
        - "Existing tests are updated to explicitly include ## [Unreleased] structure rather than relying on incidental correctness"
        - "go test ./... passes"
